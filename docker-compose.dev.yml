version: '3.8'

# Development override for docker-compose.yml
# Usage: docker-compose -f docker-compose.yml -f docker-compose.dev.yml up

services:
  timescaledb:
    ports:
      - "5432:5432"
    environment:
      POSTGRES_PASSWORD: devpassword
    volumes:
      - ./storage/migrations:/docker-entrypoint-initdb.d
      - ./scripts:/scripts

  redis:
    ports:
      - "6379:6379"
    command: redis-server --appendonly yes

  prometheus:
    ports:
      - "9090:9090"

  grafana:
    ports:
      - "3001:3000"
    environment:
      GF_SECURITY_ADMIN_PASSWORD: admin
      GF_AUTH_ANONYMOUS_ENABLED: "true"
      GF_AUTH_ANONYMOUS_ORG_ROLE: Admin

  # Development API with hot reload
  api:
    build:
      context: .
      dockerfile: docker/Dockerfile.api
      target: development
    volumes:
      - .:/app
      - /app/venv
    command: uvicorn api.main:app --host 0.0.0.0 --port 8000 --reload
    environment:
      DEBUG: "true"
      LOG_LEVEL: DEBUG

  # Development frontend with hot reload
  frontend:
    build:
      context: ./frontend
      dockerfile: ../docker/Dockerfile.frontend
      target: development
    volumes:
      - ./frontend:/app
      - /app/node_modules
    command: npm run dev
    ports:
      - "5173:5173"
